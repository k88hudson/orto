(this.webpackJsonporto=this.webpackJsonporto||[]).push([[0],{35:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n.n(a),r=n(27),i=n.n(r),s=(n(34),n(35),n(8)),l=n(10),o=n(15);n(49),n(37);o.a.apps.length?o.a.app():(console.log("INIT FIRESTORE"),o.a.initializeApp({apiKey:"AIzaSyD9yol-9NCX10hRb33MjRxLW1I2BnCatPU",authDomain:"orto-408ca.firebaseapp.com",projectId:"orto-408ca",storageBucket:"orto-408ca.appspot.com",messagingSenderId:"938595199529",appId:"1:938595199529:web:2861c65a221c3dec7a8a38"}));var b=function(){return{toFirestore:function(e){return e},fromFirestore:function(e){return Object(l.a)(Object(l.a)({},e.data()),{},{id:e.id})}}},d=o.a.auth(),j=o.a.firestore(),u={tokens:j.collection("tokens").withConverter(b()),features:j.collection("features").withConverter(b())};function h(e){var t=Object(l.a)(Object(l.a)({},e),{},{createdAt:o.a.firestore.FieldValue.serverTimestamp()});return u.tokens.add(t)}function m(){var e=Object(a.useState)(null),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){return d.onAuthStateChanged((function(e){c(e)}))}),[]),[n]}var O=n(16),f=n(5),p=n(1);function x(){var e=function(){var e=Object(a.useState)([]),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){u.features.where("archived","!=",!0).get().then((function(e){var t=[];e.forEach((function(e){return t.push(e.data())})),c(t)})).catch((function(e){return console.log(e)}))}),[]),[n]}(),t=Object(s.a)(e,1)[0];return Object(p.jsx)("div",{children:Object(p.jsx)("table",{className:"table align-middle",children:Object(p.jsx)("tbody",{children:null===t||void 0===t?void 0:t.map((function(e){return Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{style:{width:"33%"},children:Object(p.jsx)("strong",{children:e.name})}),Object(p.jsx)("td",{children:e.description}),Object(p.jsx)("td",{children:Object(p.jsx)(O.b,{className:"btn btn-primary",to:"/new/".concat(e.id),children:"Register"})})]},e.id)}))})})})}function v(e){e.preventDefault();var t=new o.a.auth.GoogleAuthProvider;d.signInWithPopup(t).catch((function(e){console.log(e)}))}function g(){return Object(p.jsx)("button",{className:"btn btn-primary",onClick:v,children:"Sign In"})}function k(){return Object(p.jsx)("button",{className:"btn btn-outline-secondary",onClick:function(e){e.preventDefault(),d.signOut()},children:"Sign out"})}function N(e){var t=e.token,n=Object(a.useRef)(null);return Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{children:t.featureId}),Object(p.jsx)("td",{children:t.origin}),Object(p.jsx)("td",{children:t.expiry&&new Date(t.expiry).toLocaleDateString()}),Object(p.jsx)("td",{children:t.token?Object(p.jsx)("input",{className:"form-control",value:t.token,readOnly:!0,ref:n}):"Generating token..."}),Object(p.jsxs)("td",{children:[t.token&&Object(p.jsx)("button",{className:"btn btn-primary",onClick:function(e){e.preventDefault(),n.current&&(n.current.select(),document.execCommand("copy"))},children:"Copy"})," ",Object(p.jsx)("button",{className:"btn btn-secondary",onClick:function(e){var n;e.preventDefault(),n=t.id,u.tokens.doc(n).delete().then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},children:"Delete"})]})]},t.id)}function y(){var e=m(),t=Object(s.a)(e,1)[0],n=null===t||void 0===t?void 0:t.uid,c=function(e){var t=Object(a.useState)([]),n=Object(s.a)(t,2),c=n[0],r=n[1];return Object(a.useEffect)((function(){if(e)return u.tokens.where("uid","==",e).onSnapshot((function(e){if(e.size){var t=[];e.forEach((function(e){var n=e.data();t.push(n)})),r(t)}else r([])}))}),[e]),[c]}(n),r=Object(s.a)(c,1)[0];return console.log(r),n?Object(p.jsx)("div",{children:Object(p.jsxs)("table",{className:"table align-middle",children:[Object(p.jsx)("thead",{children:Object(p.jsxs)("tr",{children:[Object(p.jsx)("th",{children:"Feature"}),Object(p.jsx)("th",{children:"Origin"}),Object(p.jsx)("th",{children:"Expires"}),Object(p.jsx)("th",{children:"Token"}),Object(p.jsx)("th",{})]})}),Object(p.jsx)("tbody",{children:null===r||void 0===r?void 0:r.map((function(e){return Object(p.jsx)(N,{token:e},e.id)}))})]})}):Object(p.jsxs)("div",{children:["Please"," ",Object(p.jsx)("a",{href:"#",onClick:v,children:"sign in"})," ","to see your tokens."]})}var S=n(26),C=n.n(S),w=n(29),I=["I understand that this feature is experimental and may at any point become unavailable, and may never be enabled beyond this experiment, and even if Firefox decides to enable the feature after this trial, it will be unavailable for some time.","I understand that this feature may change throughout the course of the trial.","Where possible, I agree to apply feature detection / graceful degradation to handle the case where the experimental feature is unavailable."];function D(){var e=m(),t=Object(s.a)(e,1)[0],n=null===t||void 0===t?void 0:t.uid,c=Object(f.f)(),r=Object(f.g)().featureId,i=Object(a.useRef)(null),o=Object(a.useState)({origin:"",isSubdomain:!1}),b=Object(s.a)(o,2),d=b[0],j=b[1],O=function(e){var t=Object(a.useState)(),n=Object(s.a)(t,2),c=n[0],r=n[1];return Object(a.useEffect)((function(){return u.features.doc(e).onSnapshot((function(e){r(e.data())}))}),[]),c}(r),x=function(){var e=Object(w.a)(C.a.mark((function e(t){var a,i,s;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=d.origin,i=d.isSubdomain,n&&a&&r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,h({uid:n,origin:a,featureId:r,isSubdomain:i});case 6:s=e.sent,console.log(s.id),c.push("/my");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return O?n?Object(p.jsx)("div",{className:"row",children:Object(p.jsxs)("form",{onSubmit:x,className:"col-lg-8",children:[Object(p.jsxs)("h2",{className:"mb-2",children:["Create token for ",O.name]}),Object(p.jsxs)("p",{className:"mb-4",children:[O.description,O.learnMoreLink&&Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("br",{}),Object(p.jsx)("a",{href:O.learnMoreLink,target:"_blank",rel:"noreferrer",children:"Learn More"})]})]}),Object(p.jsxs)("div",{className:"mb-3",children:[Object(p.jsx)("label",{className:"form-label",htmlFor:"origin-input",children:"Web Origin"}),Object(p.jsx)("input",{id:"origin-input",required:!0,className:"form-control",placeholder:"https://foo.com",ref:i,value:d.origin,onChange:function(e){var t,n;(j(Object(l.a)(Object(l.a)({},d),{},{origin:e.target.value})),e.target.value&&function(t){var n;try{n=new URL(t)}catch(e){return!1}return!!["http:","https:"].includes(n.protocol)}(e.target.value))?null===(t=i.current)||void 0===t||t.setCustomValidity(""):null===(n=i.current)||void 0===n||n.setCustomValidity("Origin must be a valid url starting with http or https")}})]}),Object(p.jsx)("div",{className:"mb-3",children:Object(p.jsxs)("div",{className:"form-check",children:[Object(p.jsx)("input",{className:"form-check-input",type:"checkbox",id:"isSubdomain-input",checked:d.isSubdomain,onChange:function(e){return j(Object(l.a)(Object(l.a)({},d),{},{isSubdomain:e.target.checked}))}}),Object(p.jsx)("label",{className:"form-check-label",htmlFor:"isSubdomain-input",children:"I need a token to match all subdomains of the origin."})]})}),Object(p.jsxs)("div",{className:"alert alert-warning mb-4",children:[Object(p.jsx)("p",{children:"Terms and conditions"}),I.map((function(e,t){return Object(p.jsxs)("div",{className:"form-check",children:[Object(p.jsx)("input",{id:"term-".concat(t),type:"checkbox",required:!0,className:"form-check-input"}),Object(p.jsx)("label",{htmlFor:"term-".concat(t),className:"form-check-label",children:e})]},t)}))]}),Object(p.jsx)("div",{className:"mb-3",children:Object(p.jsx)("button",{className:"btn btn-primary",children:"Register"})})]})}):Object(p.jsxs)("div",{children:["Please"," ",Object(p.jsx)("a",{href:"#",onClick:v,children:"sign in"})," ","to create a token."]}):Object(p.jsx)("div",{children:"Loading..."})}var F=n(21),L=[{key:"id",label:"Feature ID"},{key:"name",label:"Name"},{key:"description",label:"Description"},{key:"learnMoreLink",label:"Learn More Link"}];function E(){var e=Object(a.useState)({id:"",name:"",description:"",learnMoreLink:"",archived:!1}),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(p.jsxs)("form",{className:"form",onSubmit:function(e){e.preventDefault(),console.log(n)},children:[Object(p.jsx)("h3",{children:"Create a Trial"}),L.map((function(e){var t=e.key,a=e.label;return Object(p.jsxs)("div",{className:"mb-3",children:[Object(p.jsx)("label",{className:"form-label",htmlFor:"".concat(t,"-input"),children:a}),Object(p.jsx)("input",{id:"".concat(t,"-input"),required:!0,className:"form-control",value:n[t],onChange:function(e){return a=Object(F.a)({},t,e.target.value),void c(Object(l.a)(Object(l.a)({},n),a));var a}})]},t)})),Object(p.jsx)("button",{className:"btn btn-primary",children:"Create"})]})}var M=function(){var e=m(),t=Object(s.a)(e,1)[0],n=null===t||void 0===t?void 0:t.uid;return Object(p.jsxs)(O.a,{children:[Object(p.jsx)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark",children:Object(p.jsxs)("div",{className:"container",children:[Object(p.jsx)(O.b,{className:"navbar-brand",to:"/",children:"Origin trials"}),Object(p.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(p.jsx)("span",{className:"navbar-toggler-icon"})}),Object(p.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:[Object(p.jsxs)("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0",children:[Object(p.jsx)("li",{className:"nav-item",children:Object(p.jsx)(O.c,{exact:!0,className:"nav-link",activeClassName:"active","aria-current":"page",to:"/",children:"Active trials"})}),t&&Object(p.jsx)("li",{className:"nav-item",children:Object(p.jsx)(O.c,{className:"nav-link",activeClassName:"active","aria-current":"page",to:"/my",children:"My tokens"})})]}),Object(p.jsxs)("form",{className:"d-flex",children:[" ",Object(p.jsx)("span",{className:"collapse navbar-collapse me-2 text-light",children:null===t||void 0===t?void 0:t.email}),n?Object(p.jsx)(k,{}):Object(p.jsx)(g,{})]})]})]})}),Object(p.jsx)("main",{className:"container pt-4",children:Object(p.jsxs)(f.c,{children:[Object(p.jsx)(f.a,{path:"/my",children:Object(p.jsx)(y,{})}),Object(p.jsx)(f.a,{path:"/new/:featureId",children:Object(p.jsx)(D,{})}),Object(p.jsx)(f.a,{path:"/new-trial",children:Object(p.jsx)(E,{})}),Object(p.jsx)(f.a,{path:"/",children:Object(p.jsx)(x,{})})]})})]})};i.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(M,{})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.a3efce29.chunk.js.map